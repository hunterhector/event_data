# Overview

The goal is to automatically retrieve coreferences article pairs from stave database and to generate and publish tasks to MTurk for crowdsource workers to annotate.

## Publishing HITs

1. Upload documents to the stave multidoc server and retrieve the latest db.sqlite3 file.

2. Assign any new document pairs in the above database to AMT rounds using `prepare_mturk_data.py`.

3. Prepare configuration file, `amt_configs/mturk_config.json`.

4. Run `crowdsource_annotator.py` to release next round of HITs.

5. Before starting next round, first collect results by running `../mturk_annotation/AMTCollector.py`.

## Components

1. Inside folder processors/
    - [prepare_mturk_data.py](processors/prepare_mturk_data.py)
        - Overview: This module reads documents from stave multi-doc database, and assign each (new) document pair to appropriate rounds
        - Usage: prepare_mturk_data.py stave_db_path mturk_db_path
    - [crowdsource_annotator.py](processors/crowdsource_annotator.py)
        - Overview: This is the main module that loads articles to be annotated, and generate tasks and publish to Mturk platform
        - Usage:  crowdsource_annotator.py stave_db_path mturk_db_path config
            - stave_db_path : a .sqlite3 database file
            - mturk_db_path : a .json database file (generated by python TinyDB module, after running above script)
            - config : a json config file to specify parameters for the MTurk HITs
        - Requirements: needs to have credentials.py in the same folder, which loads MTurk access key from credentials.py (code Line 10)
    - [screening.py](processors/screening.py)
        - Overview: This module is used for preparing the questionnaire for qualification tests.
        - Usage: create an instantiation of the class `QualificationTest`. Init argument are,
            - template_path: path to directory containing template .xml file for questions (`QuestionForm`) and answers (`AnswerKey`)
            - questions_path: path to .tsv containing screening questions. Each line contains (question, answer, question_type)
            - k: number of questions to include in the qualification test (default is 8)
    - [hit_layout.py](processors/hit_layout.py)
        - Overview: This module is used for preparing the layout for actual HITs.
        - Usage: create an instatiation of the class `HITLayout`. Init arguments are,
            - template_dir: path to parent directory that contains the template, `template.xml`
            - website_url: a string that provide the link to the interface. This link is displayed inside the HIT layout

2. Inside folder mturk_annotation
    - [SNSSimpleServer.py](mturk_annotation/SNSSimpleServer.py)
        - Overview: this module is a server to be deployed to receive updates sent by Mturk once HITs are finished.  This modifies the mturk_db and once one round of annotation is finished, it calls to run MACE
        - Usage: SNSSimpleServer.py stave_db_path mace_code_path mturk_db_path
        - Requirements: The server access point needs to be updated on MTurk to ensure they send the http request to the right server address. (also needs to be consistent with the access point inside crowdsource_annotator.py

## Older components

- [crowdsource_seed_collector.py](processors/crowdsource_seed_collector.py)
        - Overview: This module is used to collect seed annotations (seed annotations: article pairs with gold labels or relatively high-quality annotators) from stave_db to be used later by crowdsource_annotator.py.
        - Usage: crowdsource_seed_collector.py stave_db_path mturk_db_path
            - -a flag : used to add additional article pairs if all previous article pairs are exhausted
            - stave_db_path : a .sqlite3 database file
            - mturk_db_path : a .json database file (generated by python TinyDB module)
                - Used to maintain relative information associated with the annotation task